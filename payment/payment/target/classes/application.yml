spring:
  application:
    name: payment
  datasource:
    url: jdbc:postgresql://localhost:5432/payment_db
    username: postgres
    password: 1234fool
    driver-class-name: org.postgresql.Driver
  # JPA Configuration - Disable Hibernate auto-ddl
  jpa:
    hibernate:
      ddl-auto: validate  # Only validate, don't update schema
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        default_schema: public
        jdbc:
          lob:
            non_contextual_creation: true
        # Disable schema validation that might interfere with Flyway
        jpa:
          hibernate:
            schema_validation_mode: NONE
    open-in-view: false
    
  # Flyway Configuration - Enable and configure Flyway
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    table: flyway_schema_history
    baseline-version: 1
    validate-on-migrate: true
    clean-disabled: true
    # Ensure Flyway runs before Hibernate
    init-sql: "SET ROLE 'postgres';"
  
  # Security Configuration
  security:
    filter:
      disable:
        - csrf
    csrf:
      enabled: false
  autoconfigure:
    exclude: org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration

# Logging Configuration
logging:
  level:
    org:
      hibernate: DEBUG
      springframework:
        security: DEBUG
        web: DEBUG
        boot: INFO
        orm: DEBUG
        security.web.csrf: DEBUG
    com:
      payment: TRACE
    io.jsonwebtoken: TRACE
    org.springframework.security: DEBUG
    com.payment: DEBUG

server:
  port: 8081

# JWT Configuration
jwt:
  secret-key: ZmQ0ZGI5NjQ0MzQwN2I2MjM4YTM3Y2Q5YmMyNGJhYjI2MjU3Y2JjZWE1YTU2NGM0YzUxYzM2NDY5NmU0YjUwYQ==
  expiration-time: 86400000  # 24 hours
  refresh-token:
    expiration-time: 604800000  # 7 days